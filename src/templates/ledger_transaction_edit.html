{{ template "head" . }}

{{ if .Breadcrumbs }}
<nav class="breadcrumb" aria-label="Breadcrumb">
  {{ range $i, $b := .Breadcrumbs }}
    {{ if $i }}<span class="breadcrumb-separator">&gt;</span>{{ end }}
    {{ if $b.IsCurrent }}
      <span class="breadcrumb-current">{{ $b.Name }}</span>
    {{ else }}
      <a href="{{ $b.URL }}" class="breadcrumb-item">{{ $b.Name }}</a>
    {{ end }}
  {{ end }}
</nav>
{{ end }}

<div class="page-header">
  <div class="page-header-stack">
    <h2>Edit Transaction</h2>
    <div class="page-header-meta">
      <span class="ledger-account-name">{{ .Account.Name }}</span>
      <span class="muted-text">Budget month: {{ .PeriodLabel }}</span>
    </div>
  </div>
  <div class="page-header-actions">
    <a href="/ledger/accounts/{{ .Account.ID }}" class="btn">Back</a>
    <form method="POST" action="/ledger/accounts/{{ .Account.ID }}/transactions/{{ .Transaction.ID }}/delete" class="inline-form" onsubmit="return confirm('Delete this transaction?');">
      <input type="hidden" name="_csrf" value="{{ .csrf_token }}" />
      <button type="submit" class="btn btn-danger">Delete</button>
    </form>
  </div>
</div>

<div class="ledger-form-card">
  <form method="POST" action="/ledger/accounts/{{ .Account.ID }}/transactions/{{ .Transaction.ID }}/edit">
    <input type="hidden" name="_csrf" value="{{ .csrf_token }}" />
    <div class="form-group">
      <label>Merchant</label>
      <input type="text" name="merchant" class="form-item" value="{{ .Transaction.Merchant }}" required />
    </div>
    <div class="form-group">
      <label>Amount (signed, AED)</label>
      <input type="text" inputmode="decimal" name="amount" class="form-item" value="{{ if gt .Transaction.Amount 0.0 }}+{{ end }}{{ printf "%.2f" .Transaction.Amount }}" required />
      {{ if .AmountInputHint }}<p class="help-text">{{ .AmountInputHint }}</p>{{ end }}
    </div>
    <div class="form-group">
      <label>Status</label>
      <select name="status" class="form-item">
        {{ range .TransactionStatusOptions }}
        <option value="{{ .Value }}"{{ if eq .Value (printf "%s" $.Transaction.Status) }} selected{{ end }}>{{ .Label }}</option>
        {{ end }}
      </select>
    </div>
    <div class="form-group">
      <label>Occurred at</label>
      <input type="datetime-local" name="occurred_at" class="form-item" value="{{ .Transaction.OccurredAt.Format "2006-01-02T15:04" }}" required />
    </div>
    <div class="form-group">
      <label>Budget ({{ .PeriodLabel }})</label>
      <select name="budget_id" class="form-item">
        <option value="">Uncategorized</option>
        {{ range .Budgets }}
        <option value="{{ .ID }}"{{ if eq .ID.String $.SelectedBudgetID }} selected{{ end }}>{{ .CategoryName }}</option>
        {{ end }}
      </select>
    </div>
    <div class="form-group">
      <label>Note</label>
      <textarea name="note" class="form-item" rows="2">{{ with .Transaction.Note }}{{ . }}{{ end }}</textarea>
    </div>
    <button type="submit" class="btn">Save</button>
  </form>
</div>

{{ template "foot" . }}
