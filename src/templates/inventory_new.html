{{ template "head" . }}

{{ if .Breadcrumbs }}
<nav class="breadcrumb" aria-label="Breadcrumb">
  {{ range $i, $b := .Breadcrumbs }}
    {{ if $i }}<span class="breadcrumb-separator">&gt;</span>{{ end }}
    {{ if $b.IsCurrent }}
      <span class="breadcrumb-current">{{ $b.Name }}</span>
    {{ else }}
      <a href="{{ $b.URL }}" class="breadcrumb-item">{{ $b.Name }}</a>
    {{ end }}
  {{ end }}
</nav>
{{ end }}

<div class="page-header">
  <h2>Add Inventory Item</h2>
</div>

{{ if .Error }}
<div class="alert alert-red">
  {{ .Error }}
</div>
{{ end }}

<form method="POST" action="/inventory/new" class="form">
  <input type="hidden" name="_csrf" value="{{ .csrf_token }}" />
  <div class="form-section">
    <h3>Item Information</h3>

    <div class="form-group">
      <label for="name" class="item-title">Name <span class="required">*</span></label>
      <input type="text" name="name" id="name" class="form-item" required
             value="{{ if .FormData }}{{ .FormData.Get "name" }}{{ end }}">
    </div>

    <div class="form-group">
      <label for="location" class="item-title">Location</label>
      <div class="autocomplete-container">
        <input type="text" name="location" id="location" class="form-item" autocomplete="off"
               value="{{ if .FormData }}{{ .FormData.Get "location" }}{{ end }}">
        <div class="autocomplete-dropdown" id="location-dropdown"></div>
      </div>
      <p class="help-text">Optional. Where is this item stored?</p>
    </div>

    <div class="form-group">
      <label for="description" class="item-title">Description</label>
      <textarea name="description" id="description" class="form-item" rows="4">{{ if .FormData }}{{ .FormData.Get "description" }}{{ end }}</textarea>
      <p class="help-text">Optional. Additional details about this item.</p>
    </div>

    <div class="form-group">
      <label for="status" class="item-title">Status</label>
      <select name="status" id="status" class="form-item">
        {{ range .StatusOptions }}
        <option value="{{ .Value }}"{{ if eq .Value "active" }} selected{{ end }}>{{ .Label }}</option>
        {{ end }}
      </select>
      <p class="help-text">Current status of this item.</p>
    </div>

    <div class="form-group">
      <label for="inspection_date" class="item-title">Inspection Date</label>
      <input type="date" name="inspection_date" id="inspection_date" class="form-item"
             value="{{ if .FormData }}{{ .FormData.Get "inspection_date" }}{{ end }}">
      <p class="help-text">Optional. Next inspection due date.</p>
    </div>
  </div>

  <div class="form-actions">
    <button type="submit" class="btn">Create Item</button>
    <a href="/inventory" class="btn">Cancel</a>
  </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
  var locations = [{{ range $i, $loc := .Locations }}{{ if $i }}, {{ end }}"{{ $loc }}"{{ end }}];
  if (locations.length > 0) {
    initAutocomplete('#location', locations);
  }
});
</script>

{{ template "foot" . }}
