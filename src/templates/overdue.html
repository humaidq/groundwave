{{ template "head" . }}

{{ if .Breadcrumbs }}
<nav class="breadcrumb" aria-label="Breadcrumb">
  {{ range $i, $b := .Breadcrumbs }}
    {{ if $i }}<span class="breadcrumb-separator">&gt;</span>{{ end }}
    {{ if $b.IsCurrent }}
      <span class="breadcrumb-current">{{ $b.Name }}</span>
    {{ else }}
      <a href="{{ $b.URL }}" class="breadcrumb-item">{{ $b.Name }}</a>
    {{ end }}
  {{ end }}
</nav>
{{ end }}

<div class="page-header">
  <h2>Overdue Contacts</h2>
  <a href="/contacts" class="btn">← All Contacts</a>
</div>

{{ if .Error }}
<div class="alert alert-red">
  <h5 class="alert-title">Error</h5>
  <p>{{.Error}}</p>
</div>
{{end}}

{{ if .OverdueContacts }}
{{ if .SensitiveAccess }}
<p class="muted-text overdue-help">Contacts sorted by most overdue first. Tier F contacts (no regular contact needed) are not included.</p>
{{ else }}
<p class="muted-text overdue-help">Contacts sorted by most overdue first.</p>
{{ end }}

<div class="list-card-list">
  {{ range .OverdueContacts }}
  <div class="list-card">
    <a href="/contact/{{ .ID }}" class="list-card-link">
      <div class="list-card-content">
        {{ $photo := safeImageURL .PhotoURL }}
        {{ if and $photo $.SensitiveAccess }}
        <img src="{{ $photo }}" alt="Photo of {{ .NameDisplay }}" class="contact-avatar contact-avatar-small" loading="lazy">
        {{ end }}
        <div class="list-card-body">
          <div class="list-card-title">
            {{ .NameDisplay }}
            {{ if .LastContactDate }}
            <span class="overdue-badge">{{ .DaysOverdue }} days overdue</span>
            {{ else }}
            <span class="overdue-badge overdue-badge-no-log">No log</span>
            {{ end }}
          </div>
          <div class="list-card-meta muted-text">
            {{ if .SensitiveAccess }}
              {{ if .Organization }}{{ .Organization }} • {{ end }}Tier {{ .Tier }} (every {{ .ContactInterval }} days){{ if .LastContactDate }} • Last contact: {{ .LastContactDate }}{{ end }}
            {{ else }}
              {{ if .Organization }}{{ .Organization }}{{ end }}{{ if .LastContactDate }}{{ if .Organization }} • {{ end }}Last contact: {{ .LastContactDate }}{{ end }}
            {{ end }}
          </div>
        </div>
      </div>
    </a>
  </div>
  {{ end }}
</div>
{{ else }}
<div class="alert alert-green">
  <h5 class="alert-title">All caught up!</h5>
  <p>You have no overdue contacts. Great job staying in touch!</p>
</div>
{{ end }}

{{ template "foot" . }}
