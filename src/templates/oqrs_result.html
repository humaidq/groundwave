{{ template "head" . }}

{{ with .QSO }}
<h2>A66H</h2>
<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
  <div>
    <b>Humaid Alqasimi</b><br>
    P.O. Box 2202<br>
    Ajman<br>
    United Arab Emirates<br>
    {{ if .MyGridSquare }}
      <b>Grid:</b> {{ .MyGridSquare }}
    {{ end }}
  </div>
  <div style="text-align: right; margin-left: 20px;">
    {{ if .MyRig }}
    <div>
      {{ .MyRig }}{{ if .TxPwr }} ({{ .TxPwr }}W){{ end }}
      <input type="checkbox" disabled checked style="margin-right: 5px;">
    </div>
    {{ end }}
    {{ if .MyAntenna }}
    <div style="margin-top: 5px;">
      {{ .MyAntenna }}
      <input type="checkbox" disabled checked style="margin-right: 5px;">
    </div>
    {{ end }}
  </div>
</div>

{{ if .Name }}
<p>Hello {{ .Name }}!</p>
{{ end }}
<p>Confirming our QSO</p>
{{ end }}

{{ with .QSO }}
<div class="qso-result">

  <table class="qso-summary">
    <tr>
      <th>To Radio</th>
      <th>Date<br><small>Year Month Day</small></th>
      <th>Time<br><small>UTC</small></th>
      <th>Freq.<br><small>MHz</small></th>
      <th>Report<br><small>{{ if or (eq .Mode "FT8") (eq .Mode "FT4") (eq .Mode "JS8") (eq .Mode "MSK144") (eq .Mode "JT65") (eq .Mode "JT9") }}dB &middot; <del>RST</del>{{ else }}<del>dB</del> &middot; RST{{ end }}</small></th>
      <th>Mode<br><small>2-Way</small></th>
    </tr>
    <tr>
      <td>{{ .Call }}</td>
      <td>{{ .FormatDate }}</td>
      <td>{{ .FormatTime }}</td>
      <td>{{ if .Freq }}{{ .Freq }}{{ else }}-{{ end }}</td>
      <td>{{ if .RSTRcvd }}{{ .RSTRcvd }}{{ else }}-{{ end }}</td>
      <td>{{ .Mode }}</td>
    </tr>
  </table>

  <div class="qso-details-container">
    <div class="qsl-section">
      <h4>QSL</h4>

      {{ if .IsPaperQSLReceived }}
      <div class="alert alert-green">
        <h5 class="alert-title">Tnx QSL!</h5>
        <p>Thank you for sending your QSL card! Much appreciated.</p>
      </div>
      {{ end }}

      <div class="confirmation-item">
        <div class="confirmation-info">
          <div class="confirmation-icon paper">&#x1F4EE;</div>
          <div>
            <div class="confirmation-name">Paper QSL</div>
            <div class="confirmation-subtitle">Physical Card</div>
          </div>
        </div>
        <div class="confirmation-status">
          <div class="status-indicator">
            {{ if .IsPaperQSLSent }}
            <div class="status-dot active paper"></div>
            <span class="status-text active">Sent</span>
            {{ else if .IsPaperQSLQueued }}
            <div class="status-dot queued"></div>
            <span class="status-text queued">Queued to Send</span>
            {{ else if $.HasOpenCardRequest }}
            <div class="status-dot requested"></div>
            <span class="status-text requested">Requested</span>
            {{ else }}
            <div class="status-dot inactive"></div>
            <span class="status-text inactive">Not Sent</span>
            {{ end }}
          </div>
          <div class="status-indicator">
            <div class="status-dot {{ if .IsPaperQSLReceived }}active paper{{ else }}inactive{{ end }}"></div>
            <span class="status-text {{ if .IsPaperQSLReceived }}active{{ else }}inactive{{ end }}">Received</span>
          </div>
        </div>
      </div>

      {{ if not .IsPaperQSLSent }}
      {{ if .IsPaperQSLQueued }}
      <div class="alert alert-yellow qsl-request-callout">
        <h5 class="alert-title">Card Queued</h5>
        <p>Your physical QSL card is queued and will be mailed soon.</p>
      </div>
      {{ else if .IsPaperQSLReceived }}
      <div class="alert alert-grey qsl-request-callout">
        <h5 class="alert-title">Card Will Be Sent Soon</h5>
        <p>I received your paper QSL and I will be sending your card as soon as possible.</p>
      </div>
      {{ else if $.HasOpenCardRequest }}
      <div class="alert alert-grey qsl-request-callout">
        <h5 class="alert-title">Request Received</h5>
        <p>Your physical QSL card request has been received.</p>
      </div>
      {{ else }}
      <div class="alert alert-grey qsl-request-callout">
        <h5 class="alert-title">Request a Free Physical QSL Card</h5>
        <p>No postage or cash needed. Fill in your mailing address below and I will mail your card.</p>
      </div>

      <form method="POST" action="/oqrs/request" class="qsl-request-form" id="request-physical-qsl">
        <input type="hidden" name="_csrf" value="{{ $.csrf_token }}" />
        <input type="hidden" name="path" value="{{ $.OQRSPath }}" />

        <div class="form-group">
          <label for="requester_name"><strong>Your Name (optional)</strong></label>
          <input type="text" id="requester_name" name="requester_name" class="form-item" autocomplete="name" />
        </div>

        <div class="form-group">
          <label for="mailing_address"><strong>Mailing Address</strong> <span class="required">*</span></label>
          <textarea
            id="mailing_address"
            name="mailing_address"
            class="form-item"
            rows="4"
            placeholder="Full address, including city, postal code, and country"
            required
          ></textarea>
        </div>

        <div class="form-group">
          <label for="note"><strong>Note (optional)</strong></label>
          <textarea
            id="note"
            name="note"
            class="form-item"
            rows="2"
            placeholder="Any extra delivery instructions"
          ></textarea>
        </div>

        <button type="submit" class="btn btn-block">Request Physical QSL Card</button>
      </form>
      {{ end }}
      {{ end }}

      <div class="confirmation-item">
        <div class="confirmation-info">
          <div class="confirmation-icon lotw">&#x1F30D;</div>
          <div>
            <div class="confirmation-name">Logbook of the World</div>
            <div class="confirmation-subtitle">ARRL LoTW</div>
          </div>
        </div>
        <div class="confirmation-status">
          <div class="status-indicator">
            <div class="status-dot {{ if .IsLoTWQSLSent }}active{{ else }}inactive{{ end }}"></div>
            <span class="status-text {{ if .IsLoTWQSLSent }}active{{ else }}inactive{{ end }}">Sent</span>
          </div>
          <div class="status-indicator">
            <div class="status-dot {{ if .IsLoTWQSLReceived }}active{{ else }}inactive{{ end }}"></div>
            <span class="status-text {{ if .IsLoTWQSLReceived }}active{{ else }}inactive{{ end }}">Received</span>
          </div>
        </div>
      </div>

      <div class="confirmation-item">
        <div class="confirmation-info">
          <div class="confirmation-icon eqsl">&#x1F4BB;</div>
          <div>
            <div class="confirmation-name">Electronic QSL</div>
            <div class="confirmation-subtitle">eQSL.cc</div>
          </div>
        </div>
        <div class="confirmation-status">
          <div class="status-indicator">
            <div class="status-dot {{ if .IsEQSLQSLSent }}active{{ else }}inactive{{ end }}"></div>
            <span class="status-text {{ if .IsEQSLQSLSent }}active{{ else }}inactive{{ end }}">Sent</span>
          </div>
          <div class="status-indicator">
            <div class="status-dot {{ if .IsEQSLQSLReceived }}active{{ else }}inactive{{ end }}"></div>
            <span class="status-text {{ if .IsEQSLQSLReceived }}active{{ else }}inactive{{ end }}">Received</span>
          </div>
        </div>
      </div>
    </div>

    {{ if $.MapURL }}
    <div class="qso-map">
      <h4>Grid Square Map</h4>
      <div class="map-container">
        <img src="{{ $.MapURL }}" alt="Grid square map showing {{ .MyGridSquare }} to {{ .GridSquare }}" class="map-image" />
        <p class="map-legend">
          <span class="marker-red">&bull;</span> {{ .MyGridSquare }} (A66H)
          <span class="map-arrow">&harr;</span>
          <span class="marker-blue">&bull;</span> {{ .GridSquare }} ({{ .Call }})
        </p>
      </div>
    </div>
    {{ end }}
  </div>

</div>
{{ end }}

{{ if .AllQSOs }}
<h3>All QSOs with {{ .QSO.Call }} ({{ len .AllQSOs }} total)</h3>
{{ range .AllQSOs }}
  <div class="list-card list-card-compact">
    {{ if eq .ID $.QSO.ID.String }}
    <span class="qso-current">
      {{ .FormatDate }} at {{ .FormatTime }} UTC (current)
    </span>
    {{ else }}
    <a href="/oqrs/{{ .Call | urlquery }}-{{ .UnixTimestamp }}">
      {{ .FormatDate }} at {{ .FormatTime }} UTC
    </a>
    {{ end }}
    <div class="meta">
      <p>{{ if .Band }}{{ .Band }} band{{ end }}{{ if .Mode }} &middot; {{ .Mode }}{{ end }}{{ if .RSTRcvd }} &middot; Signal: {{ .RSTRcvd }}{{ end }}</p>
    </div>
  </div>
{{ end }}
{{ end }}

{{ template "foot" . }}
