{{ template "head" . }}

{{ if .Breadcrumbs }}
<nav class="breadcrumb" aria-label="Breadcrumb">
  {{ range $i, $b := .Breadcrumbs }}
    {{ if $i }}<span class="breadcrumb-separator">&gt;</span>{{ end }}
    {{ if $b.IsCurrent }}
      <span class="breadcrumb-current">{{ $b.Name }}</span>
    {{ else }}
      <a href="{{ $b.URL }}" class="breadcrumb-item">{{ $b.Name }}</a>
    {{ end }}
  {{ end }}
</nav>
{{ end }}

<div class="page-header">
  <h2>Inventory</h2>
  {{ if .IsAdmin }}
  <a href="/inventory/new" class="btn">+ Add Item</a>
  {{ end }}
</div>

{{ if .Error }}
<div class="alert alert-red">
  {{ .Error }}
</div>
{{ end }}

<div class="tag-filter-section">
  <form method="GET" action="/inventory" class="tag-filter-form inventory-filter-form">
    <input type="text" name="q" value="{{ .SearchQuery }}" placeholder="Search" class="form-item">
  </form>

  <details class="search-syntax-help muted-text">
    <summary class="search-syntax-toggle">
      <i class="fa-solid fa-circle-question" aria-hidden="true"></i>
      <span>Search syntax</span>
    </summary>
    <p class="search-syntax-examples">
      <span>Try:</span>
      <code>category:appliance</code>,
      <code>tag:critical tag:outdoor</code>,
      <code>router</code>
    </p>
  </details>
</div>

{{ if .Items }}
<div class="list-card-list" id="inventoryList">
  {{ range .Items }}
  <div class="list-card">
    <a href="/inventory/{{ .InventoryID }}" class="list-card-link">
      <div class="list-card-title">
        <span class="inventory-id">{{ .InventoryID }}</span> - {{ .Name }}
        {{ if ne .Status "active" }}<span class="status-badge status-{{ .Status }}">{{ inventoryStatusLabel .Status }}</span>{{ end }}
        {{ if .InspectionDue }}<span class="status-badge status-inspection_due">Inspection Due</span>{{ end }}
        {{ with .ItemType }}<span class="tag-badge">{{ . }}</span>{{ end }}
      </div>
      {{ if or .Location .Description .InspectionDate .Tags }}
      <div class="list-card-meta">
        {{ with .Location }}
        <span class="list-card-location">üìç {{ . }}</span>
        {{ end }}
        {{ with .Description }}
        <span class="list-card-description">{{ . }}</span>
        {{ end }}
        {{ with .InspectionDate }}
        <span class="list-card-description">Inspection: {{ .Format "Jan 2, 2006" }}</span>
        {{ end }}
        {{ if .Tags }}
        <div class="tag-badges">
          {{ range .Tags }}
          <a href="/inventory?q=tag:{{ .Name | urlquery }}" class="tag-badge"
             onclick="event.stopPropagation(); event.preventDefault(); window.location.href='/inventory?q=tag:{{ .Name | urlquery }}';">
             {{ .Name }}
          </a>
          {{ end }}
        </div>
        {{ end }}
      </div>
      {{ end }}
    </a>
  </div>
  {{ end }}
</div>
{{ else }}
<p class="empty-state">No inventory items found.{{ if .IsAdmin }} <a href="/inventory/new">Add your first item</a>.{{ end }}</p>
{{ end }}

{{ template "foot" . }}
