{{ template "head" . }}

{{ if .Breadcrumbs }}
<nav class="breadcrumb" aria-label="Breadcrumb">
  {{ range $i, $b := .Breadcrumbs }}
    {{ if $i }}<span class="breadcrumb-separator">&gt;</span>{{ end }}
    {{ if $b.IsCurrent }}
      <span class="breadcrumb-current">{{ $b.Name }}</span>
    {{ else }}
      <a href="{{ $b.URL }}" class="breadcrumb-item">{{ $b.Name }}</a>
    {{ end }}
  {{ end }}
</nav>
{{ end }}

<div class="page-header">
  <h2>Edit {{ .Item.InventoryID }}</h2>
</div>

{{ if .Error }}
<div class="alert alert-red">
  {{ .Error }}
</div>
{{ end }}

<form method="POST" action="/inventory/{{ .Item.InventoryID }}/edit" class="form">
  <input type="hidden" name="_csrf" value="{{ .csrf_token }}" />
  <div class="form-section">
    <h3>Item Information</h3>

    <div class="form-group">
      <label class="item-title">Inventory ID</label>
      <input type="text" class="form-item" value="{{ .Item.InventoryID }}" disabled>
      <p class="help-text">Auto-generated and cannot be changed.</p>
    </div>

    <div class="form-group">
      <label for="name" class="item-title">Name <span class="required">*</span></label>
      <input type="text" name="name" id="name" class="form-item" required value="{{ .Item.Name }}">
    </div>

    <div class="form-group">
      <label for="location" class="item-title">Location</label>
      <div class="autocomplete-container">
        <input type="text" name="location" id="location" class="form-item" autocomplete="off"
               value="{{ if .Item.Location }}{{ .Item.Location }}{{ end }}">
        <div class="autocomplete-dropdown" id="location-dropdown"></div>
      </div>
    </div>

    <div class="form-group">
      <label for="description" class="item-title">Description</label>
      <textarea name="description" id="description" class="form-item" rows="4">{{ if .Item.Description }}{{ .Item.Description }}{{ end }}</textarea>
    </div>

    <div class="form-group">
      <label for="item_type" class="item-title">Type</label>
      <div class="autocomplete-container">
        <input type="text" name="item_type" id="item_type" class="form-item" autocomplete="off"
               value="{{ if .Item.ItemType }}{{ .Item.ItemType }}{{ end }}"
               placeholder="e.g., appliance, networking, cable/adapter"
               pattern="[a-z0-9._:/-]+( [a-z0-9._:/-]+)*"
               title="Lowercase letters, numbers, spaces, and ._:/- characters only">
        <div class="autocomplete-dropdown" id="item-type-dropdown"></div>
      </div>
    </div>

    <div class="form-group">
      <label for="status" class="item-title">Status</label>
      <select name="status" id="status" class="form-item">
        {{ $currentStatus := .Item.Status }}
        {{ range .StatusOptions }}
        <option value="{{ .Value }}"{{ if eq .Value $currentStatus }} selected{{ end }}>{{ .Label }}</option>
        {{ end }}
      </select>
    </div>

    <div class="form-group">
      <label for="inspection_date" class="item-title">Inspection Date</label>
      <input type="date" name="inspection_date" id="inspection_date" class="form-item"
             value="{{ if .Item.InspectionDate }}{{ .Item.InspectionDate.Format "2006-01-02" }}{{ end }}">
    </div>
  </div>

  <div class="form-actions">
    <button type="submit" class="btn">Update Item</button>
    <a href="/inventory/{{ .Item.InventoryID }}" class="btn">Cancel</a>
  </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
  var locations = [{{ range $i, $loc := .Locations }}{{ if $i }}, {{ end }}"{{ $loc }}"{{ end }}];
  var itemTypes = [{{ range $i, $type := .ItemTypes }}{{ if $i }}, {{ end }}"{{ $type }}"{{ end }}];

  if (locations.length > 0) {
    initAutocomplete('#location', locations);
  }

  if (itemTypes.length > 0) {
    initAutocomplete('#item_type', itemTypes);
  }
});
</script>

{{ template "foot" . }}
