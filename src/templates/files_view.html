{{ template "head" . }}

{{ if .Breadcrumbs }}
<nav class="breadcrumb" aria-label="Breadcrumb">
  {{ range $i, $b := .Breadcrumbs }}
    {{ if $i }}<span class="breadcrumb-separator">&gt;</span>{{ end }}
    {{ if $b.IsCurrent }}
      <span class="breadcrumb-current">{{ $b.Name }}</span>
    {{ else }}
      <a href="{{ $b.URL }}" class="breadcrumb-item">{{ $b.Name }}</a>
    {{ end }}
  {{ end }}
</nav>
{{ end }}

<div class="page-header">
  <div class="page-header-stack">
    <h2>{{ .FileName }}</h2>
    <div class="page-header-meta">
      <span class="muted-text">{{ .CurrentPathDisplay }}</span>
      {{ if or (ne .FileSize 0) (not .FileModTime.IsZero) }}
      <span class="muted-text">{{ formatFileSize .FileSize }}{{ if not .FileModTime.IsZero }} â€¢ {{ .FileModTime.Format "Jan 2, 2006" }}{{ end }}</span>
      {{ end }}
      {{ if .IsRestricted }}
      <span class="status-badge status-restricted">Restricted</span>
      {{ end }}
      {{ if .IsAdminOnly }}
      <span class="status-badge status-admin">Admin</span>
      {{ end }}
    </div>
  </div>
  <div class="page-header-actions">
    <a href="{{ .DownloadURL }}" class="btn" download="{{ .FileName }}">Download</a>
    {{ if .CanEditFile }}
    <a href="/files/edit?path={{ .CurrentPath | urlquery }}" class="btn">Edit</a>
    {{ end }}
    {{ if .HasParent }}
    <a href="/files{{ if .ParentPath }}?path={{ .ParentPath | urlquery }}{{ end }}" class="btn">Up</a>
    {{ end }}
    {{ if .ParentPath }}
    <a href="/files" class="btn">Root</a>
    {{ end }}
  </div>
</div>

{{ if .Error }}
<div class="alert alert-red">
  <h5 class="alert-title">Error</h5>
  <p>{{ .Error }}</p>
</div>
{{ end }}

{{ if .PreviewError }}
<div class="alert alert-grey">
  <h5 class="alert-title">Preview</h5>
  <p>{{ .PreviewError }}</p>
</div>
{{ end }}

<div class="file-viewer">
  {{ if eq .ViewerType "pdf" }}
  <iframe class="file-viewer-frame" src="{{ .FileURL }}" title="{{ .FileName }}" loading="lazy"></iframe>
  {{ else if eq .ViewerType "image" }}
  <img class="file-viewer-image" src="{{ .FileURL }}" alt="{{ .FileName }}" loading="lazy" />
  {{ else if eq .ViewerType "video" }}
  <video class="file-viewer-media" controls src="{{ .FileURL }}"></video>
  {{ else if eq .ViewerType "audio" }}
  <audio class="file-viewer-media" controls src="{{ .FileURL }}"></audio>
  {{ else if eq .ViewerType "text" }}
  <pre class="file-text-block">{{ .FileText }}</pre>
  {{ else if eq .ViewerType "markdown" }}
  <pre class="file-text-block file-markdown">{{ .FileText }}</pre>
  {{ else }}
  <div class="empty-state">No preview available.</div>
  {{ end }}
</div>

{{ if .IsAdmin }}
<div class="detail-section">
  <h3>Manage File</h3>
  <details class="add-item-details">
    <summary class="add-item-summary">Rename file</summary>
    <form method="POST" action="/files/rename" class="add-item-form">
      <input type="hidden" name="_csrf" value="{{ .csrf_token }}" />
      <input type="hidden" name="path" value="{{ .CurrentPath }}" />
      <div class="add-item-field">
        <input type="text" name="new_name" class="form-item" value="{{ .FileName }}" placeholder="New file name" required>
      </div>
      <button type="submit" class="btn btn-block">Rename</button>
    </form>
  </details>
  <details class="add-item-details">
    <summary class="add-item-summary">Move file</summary>
    <form method="POST" action="/files/move" class="add-item-form">
      <input type="hidden" name="_csrf" value="{{ .csrf_token }}" />
      <input type="hidden" name="path" value="{{ .CurrentPath }}" />
      <div class="add-item-field">
        <input type="text" name="target_dir" class="form-item" placeholder="Destination folder (e.g. docs/archive)">
      </div>
      <button type="submit" class="btn btn-block">Move</button>
    </form>
  </details>
  <form method="POST" action="/files/delete" class="files-manage-delete" onsubmit="return confirm('Delete this file? This cannot be undone.');">
    <input type="hidden" name="_csrf" value="{{ .csrf_token }}" />
    <input type="hidden" name="path" value="{{ .CurrentPath }}" />
    <button type="submit" class="btn btn-danger btn-block">Delete</button>
  </form>
</div>
{{ end }}

{{ template "foot" . }}
