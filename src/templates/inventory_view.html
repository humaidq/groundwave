{{ template "head" . }}

{{ if .Breadcrumbs }}
<nav class="breadcrumb" aria-label="Breadcrumb">
  {{ range $i, $b := .Breadcrumbs }}
    {{ if $i }}<span class="breadcrumb-separator">&gt;</span>{{ end }}
    {{ if $b.IsCurrent }}
      <span class="breadcrumb-current">{{ $b.Name }}</span>
    {{ else }}
      <a href="{{ $b.URL }}" class="breadcrumb-item">{{ $b.Name }}</a>
    {{ end }}
  {{ end }}
</nav>
{{ end }}

{{ if .Error }}
<div class="alert alert-red">
  {{ .Error }}
</div>
{{ end }}

<div class="page-header">
  <div class="page-header-stack">
    <h2>{{ .Item.InventoryID }} - {{ .Item.Name }}</h2>
    <div class="page-header-meta">
      <span class="status-badge status-{{ .Item.Status }}">{{ inventoryStatusLabel .Item.Status }}</span>
    </div>
  </div>
  <div class="page-header-actions">
    <a href="/inventory/{{ .Item.InventoryID }}/edit" class="btn">Edit</a>
    <form method="POST" action="/inventory/{{ .Item.InventoryID }}/delete" class="inline-form" onsubmit="return confirm('Delete this inventory item? This cannot be undone.');">
      <input type="hidden" name="_csrf" value="{{ .csrf_token }}" />
      <button type="submit" class="btn btn-danger">Delete</button>
    </form>
  </div>
</div>

<div class="detail-layout">
  <!-- Item Details -->
  <div class="detail-section">
    {{ with .Item.Location }}
    <div class="detail-item">
      <span class="detail-label">Location:</span>
      <span class="detail-value">{{ . }}</span>
    </div>
    {{ end }}
    {{ with .Item.InspectionDate }}
    <div class="detail-item">
      <span class="detail-label">Inspection Date:</span>
      <span class="detail-value">{{ .Format "Jan 2, 2006" }}{{ if $.Item.InspectionDue }} <span class="status-badge status-inspection_due">Inspection Due</span>{{ end }}</span>
    </div>
    {{ end }}
    <div class="detail-item">
      <span class="detail-label">Created:</span>
      <span class="detail-value">{{ .Item.CreatedAt.Format "Jan 2, 2006 3:04 PM" }}</span>
    </div>
  </div>

  {{ with .Item.Description }}
  <!-- Description Section -->
  <div class="detail-section">
    <h3>Description</h3>
    <div class="pre-line">{{ . }}</div>
  </div>
  {{ end }}

  <!-- Files Section -->
  <div class="detail-section">
    <h3>Files</h3>
    {{ if .Files }}
    <ul class="file-list">
      {{ range .Files }}
      <li class="file-item">
        <a href="/inventory/{{ $.Item.InventoryID }}/file/{{ .Name }}" class="file-link" target="_blank">
          ðŸ“„ {{ .Name }}
        </a>
        <span class="file-meta">{{ formatFileSize .Size }} | {{ .ModTime.Format "Jan 2, 2006" }}</span>
      </li>
      {{ end }}
    </ul>
    {{ else }}
    <p class="no-files">No files...</p>
    {{ end }}
  </div>

  <!-- Comments Section -->
  <div class="detail-section">
    <h3>Comments</h3>
    {{ if .Comments }}
    <div class="log-list">
      {{ range .Comments }}
      <div class="log-entry">
        <div class="log-header">
          <span class="log-type log-type-note">comment</span>
          <span class="log-date">{{ .CreatedAt.Format "Jan 2, 2006 3:04 PM" }}</span>
          <form method="POST" action="/inventory/{{ $.Item.InventoryID }}/comment/{{ .ID }}/delete" class="log-delete-form" onsubmit="return confirm('Delete this comment?');">
            <input type="hidden" name="_csrf" value="{{ $.csrf_token }}" />
            <button type="submit" class="btn-delete" title="Delete">Ã—</button>
          </form>
        </div>
        <div class="log-content">{{ .Content }}</div>
      </div>
      {{ end }}
    </div>
    {{ else }}
    <p class="no-comments">No comments yet.</p>
    {{ end }}

    <!-- Add Comment Form -->
    <details class="add-item-details" open>
      <summary class="add-item-summary">+ Add Comment</summary>
      <form method="POST" action="/inventory/{{ .Item.InventoryID }}/comment" class="add-item-form">
        <input type="hidden" name="_csrf" value="{{ .csrf_token }}" />
        <div class="add-item-field">
          <textarea name="content" placeholder="Add a comment..." required class="form-item" rows="4"></textarea>
        </div>
        <button type="submit" class="btn">Post Comment</button>
      </form>
    </details>
  </div>
</div>

{{ template "foot" . }}
